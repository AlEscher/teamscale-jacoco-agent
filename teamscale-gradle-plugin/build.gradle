plugins {
	id 'org.jetbrains.kotlin.jvm' version '1.3.41'
	id 'com.teamscale.java-convention'
	id 'java-gradle-plugin'
	id 'com.teamscale.coverage'
}

gradlePlugin {
	plugins {
		teamscale {
			id = "teamscale"
			implementationClass = "com.teamscale.TeamscalePlugin"
		}
	}
}

dependencies {
	implementation project(':teamscale-client')
	implementation project(':report-generator')
	implementation gradleApi()
	implementation 'org.jetbrains.kotlin:kotlin-stdlib:1.3.41'
	implementation 'org.eclipse.jgit:org.eclipse.jgit:5.0.2.201807311906-r'
	implementation 'com.squareup.retrofit2:converter-moshi:2.5.0'
}


processResources {
	inputs.property("version", version)
	filesMatching('**/plugin.properties') {
		filter {
			it.replace('%PLUGIN_VERSION_TOKEN_REPLACED_DURING_BUILD%', version)
		}
	}
}

test {
	dependsOn ':agent:publishToMavenLocal'
	dependsOn ':impacted-test-engine:publishToMavenLocal'
	dependsOn ':teamscale-client:publishToMavenLocal'
	dependsOn ':tia-client:publishToMavenLocal'
	dependsOn ':report-generator:publishToMavenLocal'
}